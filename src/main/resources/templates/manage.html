<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>세이프로드 : 포트홀 관리</title>
    <!-- Leaflet.js CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>

    <style>
        body {
            padding-top: 10px; /* header의 높이만큼 패딩 추가 */
        }
        header {
            background-color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0px 3px 5px rgba(0, 0, 0, 0.3);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 100;
        }

        nav {
            width: 30%;
        }

        nav a:hover {
            color: #007BFF;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            border: 1px solid black;
            padding: 8px;
            text-align: center;
        }

        th {
            padding: 2px 10px 2px 10px;
            text-align: center;
            border: 3px solid #ddd;
            background-color: #f2f2f2;
        }

        th:nth-child(1), td:nth-child(1) {
            width: 5%;
        }

        th:nth-child(2), td:nth-child(2) {
            width: 15%;
            word-wrap: break-word;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        th:nth-child(3),
        th:nth-child(4) {
            width: 15%;
        }

        th:nth-child(5) {
            width: 30%;
        }

        th:nth-child(6) {
            width: 10%;
        }

        th:nth-child(7) {
            width: 5%;
        }

        th:nth-child(8) {
            width: 5%;
        }

        .Title {
            font-size: 20px;
            font-weight: bold;
            text-decoration: none;
            color: black;
        }

        .nav {
            font-weight: bold;
            text-decoration: none;
            text-align: right;
            color: black;
            margin-left: 20px;
            font-size: 18px;
            padding-left: 10px;
        }

        .nav-section {
            height: 445px;
            padding: 5px;
        }

        .table-border {
            border: 1px solid black;
            border-collapse: collapse;
        }

        .table-border th,
        .table-border td {
            border: 1px solid black;
        }

        .pagination {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }

        .pagination ul {
            list-style: none;
            padding: 0;
            display: flex;
            gap: 10px;
        }

        .pagination li {
            display: inline;
        }

        .pagination a {
            text-decoration: none;
            color: black;
            padding: 10px;
            border: 1px solid #ddd;
            background-color: #f2f2f2;
            border-radius: 5px;
        }

        .pagination a:hover {
            background-color: #007BFF;
            color: white;
        }

        .pagination .active a {
            background-color: #007BFF;
            color: white;
        }

        .hover-image {
            width: auto;
            height: auto;
            max-width: 500px;
            max-height: 500px;
            display: none;
        }
        .checkbox-spacing {
            margin-left: 20px; /* 체크박스와 다음 항목 사이의 간격 */
            margin-top: 17px;
        }
        #nav {
            background-color: lightskyblue;
            color: white;
            width: 40%;
            float: left;
        }

        #nav-top {
            background-color: lightblue;
        }

        #nav-bottom {
            background-color: deepskyblue;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #section {
            color: black;
            width: 60%;
            height: 1040px;
            float: left;
        }

        #image-display {
            max-width: 100%;
            max-height: 100%;
        }

        #header {
            background-color: palegoldenrod;
            color: black;
            font-weight: bold;
            text-align: right;
            font-size: 18px;
            width: 100%;
            height: 50px;
            margin-top: 60px; /* header 높이만큼 마진 추가 */
        }
        #map {
            height: 445px;
            width: 100%;
        }

    </style>
</head>
<body>
<header>
    <div>
        <a class="Title" th:href="@{/pothole/main}">세이프 로드</a>
    </div>
    <nav>
        <a class="nav">
            <span style="color:darkgreen" th:text="${username}"></span>님 환영합니다
        </a>
        <a class="nav" th:href="@{/pothole/manage}">포트홀 관리</a>
        <a class="nav" th:href="@{/pothole/stats}">통계</a>
        <a class="nav" th:href="@{/user/login}">로그아웃</a>
    </nav>
</header>

<div id="header">
    <form th:action="@{/pothole/manage}" method="post" style="margin-right: 15px;">
        <input type="radio" name="select" value="1" class="checkbox-spacing"
               th:checked="${selectedOption == '1'}">접수 중 <!--selectedOption이 1일 경우 이 버튼이 클릭됨-->
        <input type="radio" name="select" value="2" class="checkbox-spacing"
               th:checked="${selectedOption == '2'}">접수 실패
        <input type="radio" name="select" value="3" class="checkbox-spacing"
               th:checked="${selectedOption == '3'}">접수 완료
        <input type="radio" name="select" value="4" class="checkbox-spacing"
               th:checked="${selectedOption == '4'}">수리 중
        <input type="radio" name="select" value="5" class="checkbox-spacing"
               th:checked="${selectedOption == '5'}">수리 완료
        <input type="radio" name="select" value="6" class="checkbox-spacing"
               th:checked="${selectedOption == '6'}">초기화
        <button type="submit" style="margin-left: 10px;">검색</button>
    </form>
</div>

<div id="nav">
    <div class="nav-section" id="nav-top">
        <div id="map"></div>
    </div>
    <div class="nav-section" id="nav-bottom">
        <img id="image-display" src="" alt="포트홀 이미지" style="display:none;">
    </div>
</div>

<div id="section">
    <table class="table-border">
        <thead>
        <tr>
            <th>일련번호</th>
            <th>탐지 일자</th>
            <th>위도</th>
            <th>경도</th>
            <th>주소</th>
            <th>상태</th>
            <th>유저ID</th>
            <th>이미지</th>
        </tr>
        </thead>
        <tbody>
        <tr th:if="${paging.isEmpty()}">
            <td colspan="7" style="text-align: center; font-size: 25px; font-weight: bold;">등록된 신고 내역이 없습니다.</td>
        </tr>
        <tr style="text-align: center;" th:each="pothole : ${paging.content}">
            <td th:text="${pothole.id}"></td>
            <td th:text="${pothole.detectDate}"></td>
            <td th:text="${pothole.latitude}"></td>
            <td th:text="${pothole.longitude}"></td>
            <td th:text="${pothole.address}"></td>
            <td th:text="${pothole.state}"></td>
            <td th:text="${pothole.user.userID}"></td>
            <td>
                <span style="color:purple; text-decoration: underline;" th:text="${pothole.imagePath}" onclick="showImage(this)"></span>
                <img th:src="@{/pothole_images/{imagePath}(imagePath=${pothole.imagePath})}" alt="Pothole Image" class="hover-image"/>
            </td>
        </tr>
        </tbody>
    </table>

    <div class="pagination">
        <ul>
            <li th:if="${paging.hasPrevious()}">
                <a th:href="@{/pothole/manage(page=${paging.number - 1}, select=${selectedOption})}">이전</a>
            </li>
            <li th:each="i : ${#numbers.sequence(1, paging.totalPages)}"
                th:class="${paging.number == i - 1} ? 'active' : ''">
                <a th:href="@{/pothole/manage(page=${i - 1}, select=${selectedOption})}" th:text="${i}"></a>
            </li>
            <li th:if="${paging.hasNext()}">
                <a th:href="@{/pothole/manage(page=${paging.number + 1}, select=${selectedOption})}">다음</a>
            </li>
        </ul>
    </div>

</div>

<script>
    function showImage(element) {
        // 이미지 경로를 가져오기
        var imagePath = element.nextElementSibling.src;

        // 하단 nav 영역의 img 요소에 이미지 경로 설정
        var imageDisplay = document.getElementById('image-display');
        imageDisplay.src = imagePath;
        imageDisplay.style.display = 'block';
    }
</script>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
    window.onload = function() {
        //HTML에서 id가 map인 요소에 지도 생성 , 13은 줌 레벨
        var map = L.map('map').setView([37.5665, 126.9780], 13);

        // 오픈스트리트맵 타일 이미지를 가져옴 z : 줌 레벨, x : x좌표, y : y좌표
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19, //최대 줌 레벨
            //저작권 정보 및 기여자 정보 표시(사용 규정상 반드시 추가해야됨)
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);
        //지도에 마커 추가
        var marker = L.marker([37.5665, 126.9780]).addTo(map);
        //마커에 팝업 연결
        marker.bindPopup("<b>일련번호</b><br>대한민국의 수도").openPopup();
    };
</script>
</body>
</html>
